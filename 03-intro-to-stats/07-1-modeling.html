

<!DOCTYPE html>


<html lang="en" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Linear Modeling - Multiple &#8212; Statistical Computing for Health Informatics with R/Tidyverse</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-7Q3FF7BQBT"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-7Q3FF7BQBT');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '03-intro-to-stats/07-1-modeling';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Linear Modeling - Categorical" href="07-2-modeling.html" />
    <link rel="prev" title="Linear Modeling - Simple" href="07-modeling.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../00-md/intro.html">
  
  
  
  
  
    <p class="title logo__title">Statistical Computing for Health Informatics with R/Tidyverse</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../00-md/intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01-intro-to-r/00-intro.html">Computational Thinking for Problem Solving</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to R</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../00-md/intro-to-r.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-intro-to-r/01-variables-data.html">Variables, Data Types and Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-intro-to-r/02-operations.html">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-intro-to-r/03-decision.html">Decision making</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-intro-to-r/04-iteration.html">Iterating</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-intro-to-r/05-functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-intro-to-r/06-extending.html">Extending R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to Tidyverse</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../02-intro-to-tidyverse/01-overview.html">Overview of Tidyverse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-intro-to-tidyverse/02-reading.html">Reading and Inspecting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-intro-to-tidyverse/03-extracting.html">Extracting and Arranging Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-intro-to-tidyverse/04-transforming.html">Transforming Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-intro-to-tidyverse/05-tidying.html">Tidying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-intro-to-tidyverse/06-joining.html">Joining data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-intro-to-tidyverse/07-1-plotting.html">Visualizing Data - Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-intro-to-tidyverse/07-2-plotting.html">Visualizing Data - Plots</a></li>




<li class="toctree-l1"><a class="reference internal" href="../02-intro-to-tidyverse/07-3-plotting.html">Visualizing Data - Extensions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to Statistical Computing</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../00-md/intro-to-stats.html">Introduction to Statistical Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="01-descriptive.html">Descriptive statistics</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../00-md/overview-inferential.html">Inferential Statistics</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="02-inferential.html">Inferential Statistics</a></li>

<li class="toctree-l2"><a class="reference internal" href="02-1-estimation.html">Estimating Mean/Variance of a Population</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-2-estimation.html">Estimating Uncertainty</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-3-hypothesis.html">Hypothesis testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-4-effect.html">Effect size</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../00-md/overview-tests.html">Statistical Tests</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="03-1-ttest.html">Comparing measures from 2 groups (unrelated subjects)</a></li>

<li class="toctree-l2"><a class="reference internal" href="04-1-anova.html">Comparing measures from &gt;2 groups (unrelated subjects)</a></li>

<li class="toctree-l2"><a class="reference internal" href="05-1-fishers.html">Comparing counts between 2x2 categories (unrelated subjects)</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-2-chisq.html">Comparing counts between &gt;2x2 categories (unrelated subjects)</a></li>

<li class="toctree-l2"><a class="reference internal" href="06-correlation.html">Correlating 2 measures</a></li>

</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../00-md/overview-modeling.html">Statistical Modeling</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="07-modeling.html">Linear Modeling - Simple</a></li>

<li class="toctree-l2 current active"><a class="current reference internal" href="#">Linear Modeling - Multiple</a></li>

<li class="toctree-l2"><a class="reference internal" href="07-2-modeling.html">Linear Modeling - Categorical</a></li>

<li class="toctree-l2"><a class="reference internal" href="07-3-modeling.html">Generalized Linear Model - Categorical outcome</a></li>
<li class="toctree-l2"><a class="reference internal" href="08-1-prediction.html">Modeling for Prediction</a></li>

<li class="toctree-l2"><a class="reference internal" href="08-2-explanation.html">Modeling for Explanation</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/03-intro-to-stats/07-1-modeling.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Linear Modeling - Multiple</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Linear Modeling - Multiple</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-the-linear-model-using-matrices">Solving the linear model using matrices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analytical-approach">Analytical approach</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#significance-testing-of-coefficients">Significance testing of coefficients</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-test-statistic">1. Calculate the test statistic</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#use-the-theoretical-null-distribution-to-calculate-the-p-value">2. Use the theoretical null distribution to calculate the p-value</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-interval-of-coefficients">Confidence interval of coefficients</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-library-functions">Using library functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-well-does-the-model-fit-the-data">How well does the model fit the data?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#r-2-and-adjusted-r-2">1. <span class="math notranslate nohighlight">\(R^2\)</span> and adjusted <span class="math notranslate nohighlight">\(R^2\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostic-plot-of-residuals">2. Diagnostic plot of residuals</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem-of-highly-correlated-variables">The problem of highly correlated variables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-variance-inflation-factor-vif-to-detect-collinearity">Using a variance inflation factor (VIF) to detect collinearity</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-statistical-table-and-plotting">Application: Statistical table and plotting</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-table">1. Statistical table</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-plot">2. Statistical plot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostic-plot">3. Diagnostic plot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-modeling-multiple-covariates">Exercise - Modeling (Multiple covariates)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1">Part 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2">Part 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3">Part 3</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="linear-modeling-multiple">
<h1>Linear Modeling - Multiple<a class="headerlink" href="#linear-modeling-multiple" title="Permalink to this heading">#</a></h1>
<p>We previously considered a single covariate in the linear model and saw how the linear equation could be used to find the coefficients that fit the model by minimizing the sum of squares</p>
<p><img alt="lm_multi.png" src="../_images/lm_multi.png" /></p>
<p>The linear model can be extended to accomodate additional covariates as independent variables (i.e. they do not depend on each other)</p>
<p>We will explore</p>
<ul class="simple">
<li><p>how multiple covariates can be fitted using the linear model</p></li>
<li><p>what the addition of covariates means</p></li>
<li><p>what problems may arise from selection of covariates</p></li>
</ul>
<hr class="docutils" />
<section id="data-preparation">
<h2>Data preparation<a class="headerlink" href="#data-preparation" title="Permalink to this heading">#</a></h2>
<p>We will use the dataset from the Framingham study, which was a long term study of cardiovascular disease about subjsects in Framingham, USA. In this dataset ~4000 subjects were followed up and clinical data and chronic heart disease outcomes were examined longitudinally over &gt; 10 years</p>
<p>Variables include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">male</span></code> : 0 = female, 1 = male</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">age</span></code> : Age at the time of medical examination in years.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">education</span></code> : 1 = Some high school, 2 = high school/GED, 3 = some college/vocational school, 4 = college</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">currentSmoker</span></code>: Current cigarette smoking at the time of examinations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cigsPerDay</span></code>: Number of cigarettes smoked each day</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BPmeds</span></code>: Use of Anti-hypertensive medication at exam</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prevalentStroke</span></code>: Prevalent Stroke</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prevalentHyp</span></code>: Prevalent Hypertensive</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">diabetes</span></code>: Diabetic according to criteria of first exam treated</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">totChol</span></code>: Total cholesterol (mg/dL)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sysBP</span></code>: Systolic Blood Pressure (mmHg)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">diaBP</span></code>: Diastolic blood pressure (mmHg)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BMI</span></code>: Body Mass Index, weight (kg)/height (m)^2</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">heartRate</span></code>: Heart rate (beats/minute)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">glucose</span></code>: Blood glucose level (mg/dL)</p></li>
</ul>
<p>We will build a model with <code class="docutils literal notranslate"><span class="pre">sysBP</span></code> as a response and explore its relationship with other variable(s). In this case, we will filter out cases that are on antihypertensive medication <code class="docutils literal notranslate"><span class="pre">BPMeds</span> <span class="pre">==</span> <span class="pre">0</span></code></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>

<span class="c1"># load data</span>
<span class="n">data</span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;https://raw.githubusercontent.com/kennethban/dataset/main/framingham.csv&quot;</span><span class="p">)</span>

<span class="c1"># rename and change data types</span>
<span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">rename</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">male</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">education</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">education</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">currentSmoker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">currentSmoker</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">BPMeds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">BPMeds</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">prevalentStroke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">prevalentStroke</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">prevalentHyp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">prevalentHyp</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">diabetes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">diabetes</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">TenYearCHD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">TenYearCHD</span><span class="p">))</span>

<span class="c1"># filter out cases with BPMeds and drop missing values</span>
<span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">filter</span><span class="p">(</span><span class="n">BPMeds</span><span class="o">==</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="n">drop_na</span><span class="w">  </span>

<span class="nf">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>── <span class=" -Color -Color-Bold">Attaching core tidyverse packages</span> ───────────────────────────── tidyverse 2.0.0 ──
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">dplyr    </span> 1.1.1     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">readr    </span> 2.1.4
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">forcats  </span> 1.0.0     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">stringr  </span> 1.5.0
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">ggplot2  </span> 3.4.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tibble   </span> 3.2.1
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">lubridate</span> 1.9.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tidyr    </span> 1.3.0
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">purrr    </span> 1.0.1     
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>── <span class=" -Color -Color-Bold">Conflicts</span> ─────────────────────────────────────────────── tidyverse_conflicts() ──
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">filter()</span> masks <span class=" -Color -Color-Blue">stats</span>::filter()
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">lag()</span>    masks <span class=" -Color -Color-Blue">stats</span>::lag()
<span class=" -Color -Color-Cyan">ℹ</span> Use the conflicted package (<span class=" -Color -Color-Blue">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Rows: </span><span class=" -Color -Color-Blue">4240</span> <span class=" -Color -Color-Bold">Columns: </span><span class=" -Color -Color-Blue">16</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Cyan">──</span> <span class=" -Color -Color-Bold">Column specification</span> <span class=" -Color -Color-Cyan">─────────────────────────────────────────────────────────────</span>
<span class=" -Color -Color-Bold">Delimiter:</span> &quot;,&quot;
<span class=" -Color -Color-Green">dbl</span> (16): male, age, education, currentSmoker, cigsPerDay, BPMeds, prevalent...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Cyan">ℹ</span> Use `spec()` to retrieve the full column specification for this data.
<span class=" -Color -Color-Cyan">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 16</caption>
<thead>
	<tr><th scope=col>sex</th><th scope=col>age</th><th scope=col>education</th><th scope=col>currentSmoker</th><th scope=col>cigsPerDay</th><th scope=col>BPMeds</th><th scope=col>prevalentStroke</th><th scope=col>prevalentHyp</th><th scope=col>diabetes</th><th scope=col>totChol</th><th scope=col>sysBP</th><th scope=col>diaBP</th><th scope=col>BMI</th><th scope=col>heartRate</th><th scope=col>glucose</th><th scope=col>TenYearCHD</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>39</td><td>4</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>195</td><td>106.0</td><td> 70</td><td>26.97</td><td>80</td><td> 77</td><td>0</td></tr>
	<tr><td>0</td><td>46</td><td>2</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>250</td><td>121.0</td><td> 81</td><td>28.73</td><td>95</td><td> 76</td><td>0</td></tr>
	<tr><td>1</td><td>48</td><td>1</td><td>1</td><td>20</td><td>0</td><td>0</td><td>0</td><td>0</td><td>245</td><td>127.5</td><td> 80</td><td>25.34</td><td>75</td><td> 70</td><td>0</td></tr>
	<tr><td>0</td><td>61</td><td>3</td><td>1</td><td>30</td><td>0</td><td>0</td><td>1</td><td>0</td><td>225</td><td>150.0</td><td> 95</td><td>28.58</td><td>65</td><td>103</td><td>1</td></tr>
	<tr><td>0</td><td>46</td><td>3</td><td>1</td><td>23</td><td>0</td><td>0</td><td>0</td><td>0</td><td>285</td><td>130.0</td><td> 84</td><td>23.10</td><td>85</td><td> 85</td><td>0</td></tr>
	<tr><td>0</td><td>43</td><td>2</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>228</td><td>180.0</td><td>110</td><td>30.30</td><td>77</td><td> 99</td><td>0</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">ggpairs</span></code> from the <code class="docutils literal notranslate"><span class="pre">GGally</span></code> library to do the pairwise plots and see the relationships between different variables</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sysBP</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BMI</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">age</span></code></p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">GGally</span><span class="p">)</span>

<span class="c1"># adjust size of the image output</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">8</span><span class="p">)</span>

<span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">sysBP</span><span class="p">,</span><span class="w"> </span><span class="n">BMI</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">         </span><span class="nf">ggpairs</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">         </span><span class="nf">theme_grey</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered S3 method overwritten by &#39;GGally&#39;:
  method from   
  +.gg   ggplot2
</pre></div>
</div>
<img alt="../_images/49de5b4fe4822c8bfbad07686a17682731b6aab71f14bae345144e1fced59d87.png" src="../_images/49de5b4fe4822c8bfbad07686a17682731b6aab71f14bae345144e1fced59d87.png" />
</div>
</div>
<p>Recall that in the previous notebook, we estimated the effect of BMI on systolic BP</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fit_BMI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>

<span class="n">fit_BMI</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># tidy up the linear model output</span>
<span class="w">            </span><span class="nf">select</span><span class="p">(</span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>87.068295</td></tr>
	<tr><td>BMI        </td><td> 1.721042</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Let us get the estimates for the effect of age on systolic BP</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fit_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>

<span class="n">fit_age</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># tidy up the linear model output</span>
<span class="w">            </span><span class="nf">select</span><span class="p">(</span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>85.7252063</td></tr>
	<tr><td>age        </td><td> 0.9237601</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>When performing regression on the individual covariates (age OR BMI) separately, we are not sure about the contributions of <strong>both</strong> age and BMI on the systolic BP</p>
<ul class="simple">
<li><p>For example, if there was an association between age and BMI, the effect of BMI on the systolic BP could be overestimated because we did not account for the effect of age on BMI</p></li>
</ul>
<p><img alt="lm_bmi_age_bp.png" src="../_images/lm_bmi_age_bp.png" /></p>
<p>The inclusion of both covariates in the model would allow us to address these questions</p>
<ul class="simple">
<li><p>What is the association of BMI on systolic BP when age is kept constant?</p></li>
<li><p>What is the association of age on systolic BP when BMI is kept constant?</p></li>
</ul>
<p>We will explore how we can fit <strong>both</strong> covariates in the model</p>
</section>
<section id="solving-the-linear-model-using-matrices">
<h2>Solving the linear model using matrices<a class="headerlink" href="#solving-the-linear-model-using-matrices" title="Permalink to this heading">#</a></h2>
<p>We can accomodate additional covariates by extending the linear equation</p>
<div class="math notranslate nohighlight">
\[y_{i}=\beta_{0}+\beta_{1} x_{i 1}+\beta_{2} x_{i 2}+\ldots+\beta_{k} x_{i k}+e_{i}\quad\]</div>
<div class="math notranslate nohighlight">
\[\text{for}\ i =\text{sample},k =\text{independent variable}\]</div>
<p>This can be expressed in a matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{array}{l}y_{1} \\ y_{2} \\ y_{n}\end{array}\right]=\left[\begin{array}{cccc}1 &amp; x_{11} &amp; x_{12} &amp; \ldots &amp; x_{1 k} \\ 1 &amp; x_{21} &amp; x_{22} &amp; \ldots &amp; x_{2 k} \\ 1 &amp; x_{n 1} &amp; x_{n 2} &amp; \ldots &amp; x_{n k}\end{array}\right]\left[\begin{array}{c}\beta_{0} \\ \beta_{1} \\ \beta_{2} \\ \beta_{k}\end{array}\right]+\left[\begin{array}{c}e_{1} \\ e_{2} \\ e_{n}\end{array}\right]\end{split}\]</div>
<p>More compactly, it can be expressed as</p>
<div class="math notranslate nohighlight">
\[Y=X \beta+e\]</div>
<p>We can obtain the beta coefficients via the following matrix operation that finds the minimum <span class="math notranslate nohighlight">\(SS\)</span>.</p>
<div class="math notranslate nohighlight">
\[\hat{\beta}=\left(X^{T} X\right)^{-1} X^{T} Y\]</div>
<p>For details, see <a class="reference external" href="https://textbooks.math.gatech.edu/ila/least-squares.html">https://textbooks.math.gatech.edu/ila/least-squares.html</a>. Also, note the inverse matrix operation <span class="math notranslate nohighlight">\(\left(X^{T} X\right)^{-1}\)</span> that will become relevant later when we consider multiple covariates</p>
<p>As before, we use the <code class="docutils literal notranslate"><span class="pre">lm</span></code> function for fit a model. We can specify additional covariates by using the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fit_BMI_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="c1"># fit both BMI + age</span>

<span class="n">fit_BMI_age</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># tidy up the linear model output</span>
<span class="w">                </span><span class="nf">select</span><span class="p">(</span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>51.5287670</td></tr>
	<tr><td>BMI        </td><td> 1.4990839</td></tr>
	<tr><td>age        </td><td> 0.8358078</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>From the <span class="math notranslate nohighlight">\(b_0\)</span>, <span class="math notranslate nohighlight">\(b_1\)</span> and <span class="math notranslate nohighlight">\(b_2\)</span> coefficients, we have the linear equation relating systolic BP and the covariates BMI and age from the data</p>
<div class="math notranslate nohighlight">
\[y = b_0 + b_1 x_1 + b_2 x_2\]</div>
<div class="math notranslate nohighlight">
\[\text{sysBP} = 51.53_\text{intercept} + 1.50_\text{BMI} \times \text{BMI} + 0.84_\text{age} \times \text{age}
\]</div>
<p>These coefficients for BMI and age represent the effect sizes when the other covariate is held <strong>constant</strong></p>
<p><img alt="lm_adjustment.png" src="../_images/lm_adjustment.png" /></p>
<p>We now have estimates of the BMI and age coefficients from the linear model, but we do not know</p>
<ul class="simple">
<li><p>if the estimates could have arisen by random chance</p></li>
<li><p>the range of uncertainty of the coefficients</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="analytical-approach">
<h2>Analytical approach<a class="headerlink" href="#analytical-approach" title="Permalink to this heading">#</a></h2>
<section id="significance-testing-of-coefficients">
<h3>Significance testing of coefficients<a class="headerlink" href="#significance-testing-of-coefficients" title="Permalink to this heading">#</a></h3>
<section id="calculate-the-test-statistic">
<h4>1. Calculate the test statistic<a class="headerlink" href="#calculate-the-test-statistic" title="Permalink to this heading">#</a></h4>
<p>We will calculate the t-statistic for the coefficients and use them to find the p-values from the null t-distribution</p>
<div class="math notranslate nohighlight">
\[t_{b_0} = \frac{b_0}{\operatorname{SE}(b_{0})}\]</div>
<div class="math notranslate nohighlight">
\[t_{b_1} = \frac{b_1}{\operatorname{SE}(b_{1})}\]</div>
<p>Recall that</p>
<div class="math notranslate nohighlight">
\[y_{i}=\beta_{0}+\beta_{1} x_{i 1}+\beta_{2} x_{i 2}+\ldots+\beta_{k} x_{i k}+e_{i}\]</div>
<div class="math notranslate nohighlight">
\[\text{for}\ i =\text{sample},k =\text{independent variable}\]</div>
<p>The linear equations can be expressed in a matrix form</p>
<div class="math notranslate nohighlight">
\[Y=X \beta+\epsilon\]</div>
<p>We would like to find the standard error of the different coefficients, which are based on the variance of the error term <span class="math notranslate nohighlight">\(\epsilon\)</span></p>
<div class="math notranslate nohighlight">
\[\epsilon=Y-X \beta\]</div>
<div class="math notranslate nohighlight">
\[s^2=1/(n-k)\cdot\epsilon^{T}\epsilon\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\text{where }n &amp;= \text{number of samples}\\
k &amp;= \text{number of parameters}
\end{align}
\end{split}\]</div>
<p>We can then obtain the standard errors for the coefficients</p>
<div class="math notranslate nohighlight">
\[\operatorname{SE}(b_0)=s^2\left(X^{T} X\right)_{11}^{-1}\quad \text{for intercept}\]</div>
<div class="math notranslate nohighlight">
\[\operatorname{SE}(b_k)=s^2\left(X^{T} X\right)_{kk}^{-1}\quad \text{for variable}\ k\]</div>
<p>Finally, we obtain the t-statistic for the coefficients that will be used for significance testing</p>
<div class="math notranslate nohighlight">
\[t_{b_0} = \frac{b_0}{\operatorname{SE}(b_0)}\]</div>
<div class="math notranslate nohighlight">
\[t_{b_k} = \frac{b_k}{\operatorname{SE}(b_k)}\]</div>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">lm</span></code> function to obtain the t-statistic for the intercept, BMI and age</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summary</span>

<span class="n">t_b0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="c1"># intercept</span>
<span class="n">t_b1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="c1"># BMI</span>
<span class="n">t_b2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="c1"># age</span>

<span class="nf">tibble</span><span class="p">(</span><span class="n">term</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;intercept&quot;</span><span class="p">,</span><span class="s">&quot;BMI&quot;</span><span class="p">,</span><span class="s">&quot;age&quot;</span><span class="p">),</span>
<span class="w">       </span><span class="n">t_stat</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">t_b0</span><span class="p">,</span><span class="n">t_b1</span><span class="p">,</span><span class="n">t_b2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>t_stat</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>intercept</td><td>19.99455</td></tr>
	<tr><td>BMI      </td><td>18.98957</td></tr>
	<tr><td>age      </td><td>22.52510</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="use-the-theoretical-null-distribution-to-calculate-the-p-value">
<h4>2. Use the theoretical null distribution to calculate the p-value<a class="headerlink" href="#use-the-theoretical-null-distribution-to-calculate-the-p-value" title="Permalink to this heading">#</a></h4>
<p>The null t distribution is parameterized by the degrees of freedom <code class="docutils literal notranslate"><span class="pre">df</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code> = number of samples - number of parameters</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">num_parameters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c1"># b0, b1, b2</span>

<span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">num_parameters</span>

<span class="n">df</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">3544</div></div>
</div>
<p>We use the <code class="docutils literal notranslate"><span class="pre">vdist_t_prob</span></code> function from the <code class="docutils literal notranslate"><span class="pre">vistributions</span></code> library to plot the t-distribution parameterized by <code class="docutils literal notranslate"><span class="pre">df</span></code> and t-statistic for the <code class="docutils literal notranslate"><span class="pre">intercept</span></code>, <code class="docutils literal notranslate"><span class="pre">BMI</span></code> and <code class="docutils literal notranslate"><span class="pre">age</span></code></p>
<ul class="simple">
<li><p>intercept</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">vistributions</span><span class="p">)</span>

<span class="c1"># adjust size of the image output</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">8</span><span class="p">)</span>

<span class="nf">vdist_t_prob</span><span class="p">(</span><span class="n">perc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_b0</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/58ee440b18b0dded462ea79d9b21888e7dc3d9cf039c6921d2d3d6eb63265245.png" src="../_images/58ee440b18b0dded462ea79d9b21888e7dc3d9cf039c6921d2d3d6eb63265245.png" />
</div>
</div>
<ul class="simple">
<li><p>BMI</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">vdist_t_prob</span><span class="p">(</span><span class="n">perc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_b1</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/d212bc2f1426ba8dcdf25b245baa46108f8c9d72f2f2a37a4941b3726feceda2.png" src="../_images/d212bc2f1426ba8dcdf25b245baa46108f8c9d72f2f2a37a4941b3726feceda2.png" />
</div>
</div>
<ul class="simple">
<li><p>age</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">vdist_t_prob</span><span class="p">(</span><span class="n">perc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_b2</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/53be4ae52499eea7573054b5e460f17dd141ccd1a9402506df362515e14fa661.png" src="../_images/53be4ae52499eea7573054b5e460f17dd141ccd1a9402506df362515e14fa661.png" />
</div>
</div>
</section>
</section>
<section id="confidence-interval-of-coefficients">
<h3>Confidence interval of coefficients<a class="headerlink" href="#confidence-interval-of-coefficients" title="Permalink to this heading">#</a></h3>
<p>Recall that the 95% confidence interval is defined as</p>
<div class="math notranslate nohighlight">
\[\bar{x}-t_\mathit{lower}\times{SE} \leq \mu \leq \bar{x}+t_\mathit{upper}\times{SE}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\text{where } \mu &amp;= \text{population mean of coefficient}\\
\bar{x} &amp;= \text{sample mean of coefficient}\\
SE &amp;= \text{standard error } \frac{s}{\sqrt{n}}\\
t_\mathit{lower} &amp;= 2.5 \text{ percentile t-score}\\
t_\mathit{upper} &amp;= 97.5 \text{ percentile t-score}
\end{align}
\end{split}\]</div>
<p>The lower and upper t-scores are obtained using the <code class="docutils literal notranslate"><span class="pre">qt</span></code> function</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lower_t_score</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">qt</span><span class="p">(</span><span class="m">0.025</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">)</span>
<span class="n">upper_t_score</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">qt</span><span class="p">(</span><span class="m">0.975</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">)</span>

<span class="nf">tibble</span><span class="p">(</span><span class="n">percentile</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;0.025&quot;</span><span class="p">,</span><span class="s">&quot;0.975&quot;</span><span class="p">),</span>
<span class="w">       </span><span class="n">t_score</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">lower_t_score</span><span class="p">,</span><span class="n">upper_t_score</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>percentile</th><th scope=col>t_score</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0.025</td><td>-1.960634</td></tr>
	<tr><td>0.975</td><td> 1.960634</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We obtain the coefficient values and their standard errors from the <code class="docutils literal notranslate"><span class="pre">lm</span></code> object</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">b0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># intercept</span>
<span class="n">b1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># BMI</span>
<span class="n">b2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># age</span>

<span class="n">se_b0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="c1"># intercept</span>
<span class="n">se_b1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="c1"># BMI</span>
<span class="n">se_b2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="c1"># age</span>

<span class="nf">tibble</span><span class="p">(</span><span class="n">type</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;intercept&quot;</span><span class="p">,</span><span class="s">&quot;BMI&quot;</span><span class="p">,</span><span class="s">&quot;age&quot;</span><span class="p">),</span>
<span class="w">       </span><span class="n">coefficient</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">),</span>
<span class="w">       </span><span class="n">std_err</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">se_b0</span><span class="p">,</span><span class="n">se_b1</span><span class="p">,</span><span class="n">se_b2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 3</caption>
<thead>
	<tr><th scope=col>type</th><th scope=col>coefficient</th><th scope=col>std_err</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>intercept</td><td>51.5287670</td><td>2.57714073</td></tr>
	<tr><td>BMI      </td><td> 1.4990839</td><td>0.07894250</td></tr>
	<tr><td>age      </td><td> 0.8358078</td><td>0.03710561</td></tr>
</tbody>
</table>
</div></div>
</div>
<p><strong>intercept</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lower</span></code>: intercept + t_score(0.025) x std error of intercept</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">upper</span></code>: intercept + t_score(0.975) x std error of intercept</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 95% CI for b0</span>

<span class="n">b0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lower_t_score</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">se_b0</span>
<span class="n">b0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">upper_t_score</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">se_b0</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">46.4759382952356</div><div class="output text_html">56.5815956502569</div></div>
</div>
<p><strong>BMI</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lower</span></code>: BMI + t_score(0.025) x std error of BMI</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">upper</span></code>: BMI + t_score(0.975) x std error of BMI</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 95% CI for b1</span>

<span class="n">b1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lower_t_score</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">se_b1</span>
<span class="n">b1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">upper_t_score</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">se_b1</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">1.34430657963936</div><div class="output text_html">1.65386121394803</div></div>
</div>
<p><strong>age</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lower</span></code>: age + t_score(0.025) x std error of age</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">upper</span></code>: age + t_score(0.975) x std error of age</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 95% CI for b2</span>

<span class="n">b2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lower_t_score</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">se_b2</span>
<span class="n">b2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">upper_t_score</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">se_b2</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">0.763057268025778</div><div class="output text_html">0.908558285239887</div></div>
</div>
</section>
</section>
<section id="using-library-functions">
<h2>Using library functions<a class="headerlink" href="#using-library-functions" title="Permalink to this heading">#</a></h2>
<p>We use the <code class="docutils literal notranslate"><span class="pre">lm</span></code> function to obtain the estimates and the <em>p-values</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fit_BMI_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>

<span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">(</span><span class="n">fit_BMI_age</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 5</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th><th scope=col>std.error</th><th scope=col>statistic</th><th scope=col>p.value</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>51.5287670</td><td>2.57714073</td><td>19.99455</td><td> 2.335230e-84</td></tr>
	<tr><td>BMI        </td><td> 1.4990839</td><td>0.07894250</td><td>18.98957</td><td> 1.179596e-76</td></tr>
	<tr><td>age        </td><td> 0.8358078</td><td>0.03710561</td><td>22.52510</td><td>4.052878e-105</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>To get the confidence intervals of the coefficients, we use the <code class="docutils literal notranslate"><span class="pre">confint</span></code> function on the <code class="docutils literal notranslate"><span class="pre">lm</span></code> object</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">confint</span><span class="p">(</span><span class="n">fit_BMI_age</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A matrix: 3 × 2 of type dbl</caption>
<thead>
	<tr><th></th><th scope=col>2.5 %</th><th scope=col>97.5 %</th></tr>
</thead>
<tbody>
	<tr><th scope=row>(Intercept)</th><td>46.4759383</td><td>56.5815957</td></tr>
	<tr><th scope=row>BMI</th><td> 1.3443066</td><td> 1.6538612</td></tr>
	<tr><th scope=row>age</th><td> 0.7630573</td><td> 0.9085583</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<hr class="docutils" />
<section id="how-well-does-the-model-fit-the-data">
<h2>How well does the model fit the data?<a class="headerlink" href="#how-well-does-the-model-fit-the-data" title="Permalink to this heading">#</a></h2>
<p>We can assess how well the model fits the data by looking at</p>
<ul class="simple">
<li><p>goodness of fit measures:  <span class="math notranslate nohighlight">\(R^2\)</span> and adjusted <span class="math notranslate nohighlight">\(R^2\)</span></p></li>
<li><p>diagnostic plots of the residuals after fitting</p></li>
</ul>
<section id="r-2-and-adjusted-r-2">
<h3>1. <span class="math notranslate nohighlight">\(R^2\)</span> and adjusted <span class="math notranslate nohighlight">\(R^2\)</span><a class="headerlink" href="#r-2-and-adjusted-r-2" title="Permalink to this heading">#</a></h3>
<p>We can estimate the goodness of fit of the model to the data by looking at the <span class="math notranslate nohighlight">\(R^2\)</span> and adjusted <span class="math notranslate nohighlight">\(R^2\)</span></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">fit_BMI_age</span><span class="p">)</span><span class="o">$</span><span class="n">r.squared</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit_BMI_age</span><span class="p">)</span><span class="o">$</span><span class="n">adj.r.squared</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">0.218383931637886</div><div class="output text_html">0.217942839048517</div></div>
</div>
<p>We can see that the <span class="math notranslate nohighlight">\(R^2\)</span> has increased compared to the single covariate fit (BMI only), indicating that the additional covariate (age) improved the fit to the data</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">fit_BMI</span><span class="p">)</span><span class="o">$</span><span class="n">r.squared</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit_BMI</span><span class="p">)</span><span class="o">$</span><span class="n">adj.r.squared</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">0.10648308068169</div><div class="output text_html">0.106231030774971</div></div>
</div>
</section>
<section id="diagnostic-plot-of-residuals">
<h3>2. Diagnostic plot of residuals<a class="headerlink" href="#diagnostic-plot-of-residuals" title="Permalink to this heading">#</a></h3>
<p>We can look at the plot of residuals</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggfortify</span><span class="p">)</span>

<span class="c1"># adjust size of the image output</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">5</span><span class="p">)</span>

<span class="nf">autoplot</span><span class="p">(</span><span class="n">fit_BMI_age</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/79cb4cf244555b3722000b22d3dfa4fa454140641b4e48821f421fd6fe0df0bf.png" src="../_images/79cb4cf244555b3722000b22d3dfa4fa454140641b4e48821f421fd6fe0df0bf.png" />
</div>
</div>
<p>Most residuals are centered around 0 and the QQ plot shows that that the residuals are closer to a normal distribution except for the higher values and outliers</p>
<p>We can compare this to the previous fit with only BMI as the covariate</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># adjust size of the image output</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">5</span><span class="p">)</span>

<span class="nf">autoplot</span><span class="p">(</span><span class="n">fit_BMI</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3e63baaa5bf576f4a60415552f78f984ad37abf5e096fcaa55cdc4507261c882.png" src="../_images/3e63baaa5bf576f4a60415552f78f984ad37abf5e096fcaa55cdc4507261c882.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="the-problem-of-highly-correlated-variables">
<h2>The problem of highly correlated variables<a class="headerlink" href="#the-problem-of-highly-correlated-variables" title="Permalink to this heading">#</a></h2>
<p>For a linear model with multiple covariates, we use the matrix form</p>
<div class="math notranslate nohighlight">
\[Y=X \beta+e\]</div>
<p>Recall that we obtain the beta coefficients via the following matrix operation that finds the minimum <span class="math notranslate nohighlight">\(SS\)</span></p>
<div class="math notranslate nohighlight">
\[\hat{\beta}=\left(X^{T} X\right)^{-1} X^{T} Y\]</div>
<p>If covariates are highly correlated, the <span class="math notranslate nohighlight">\(X^{T} X\)</span> matrix cannot be inverted thus leading to spurious results</p>
<p>We’ll illustrate by adding another covariate called <code class="docutils literal notranslate"><span class="pre">BMI_related</span></code> which is derived from <code class="docutils literal notranslate"><span class="pre">BMI</span></code></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a highly correlated covariate </span>

<span class="n">data_correlated</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="n">BMI_related</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jitter</span><span class="p">(</span><span class="n">BMI</span><span class="p">,</span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">))</span>

<span class="nf">head</span><span class="p">(</span><span class="n">data_correlated</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 17</caption>
<thead>
	<tr><th scope=col>sex</th><th scope=col>age</th><th scope=col>education</th><th scope=col>currentSmoker</th><th scope=col>cigsPerDay</th><th scope=col>BPMeds</th><th scope=col>prevalentStroke</th><th scope=col>prevalentHyp</th><th scope=col>diabetes</th><th scope=col>totChol</th><th scope=col>sysBP</th><th scope=col>diaBP</th><th scope=col>BMI</th><th scope=col>heartRate</th><th scope=col>glucose</th><th scope=col>TenYearCHD</th><th scope=col>BMI_related</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>39</td><td>4</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>195</td><td>106.0</td><td> 70</td><td>26.97</td><td>80</td><td> 77</td><td>0</td><td>26.34304</td></tr>
	<tr><td>0</td><td>46</td><td>2</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>250</td><td>121.0</td><td> 81</td><td>28.73</td><td>95</td><td> 76</td><td>0</td><td>30.69973</td></tr>
	<tr><td>1</td><td>48</td><td>1</td><td>1</td><td>20</td><td>0</td><td>0</td><td>0</td><td>0</td><td>245</td><td>127.5</td><td> 80</td><td>25.34</td><td>75</td><td> 70</td><td>0</td><td>25.62239</td></tr>
	<tr><td>0</td><td>61</td><td>3</td><td>1</td><td>30</td><td>0</td><td>0</td><td>1</td><td>0</td><td>225</td><td>150.0</td><td> 95</td><td>28.58</td><td>65</td><td>103</td><td>1</td><td>27.33813</td></tr>
	<tr><td>0</td><td>46</td><td>3</td><td>1</td><td>23</td><td>0</td><td>0</td><td>0</td><td>0</td><td>285</td><td>130.0</td><td> 84</td><td>23.10</td><td>85</td><td> 85</td><td>0</td><td>25.48344</td></tr>
	<tr><td>0</td><td>43</td><td>2</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>228</td><td>180.0</td><td>110</td><td>30.30</td><td>77</td><td> 99</td><td>0</td><td>31.42746</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We can plot the pairs of variables to look a the correlations using <code class="docutils literal notranslate"><span class="pre">ggpairs</span></code></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">GGally</span><span class="p">)</span>

<span class="c1"># adjust size of the image output</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">8</span><span class="p">)</span>

<span class="n">data_correlated</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">sysBP</span><span class="p">,</span><span class="w"> </span><span class="n">BMI</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">BMI_related</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">                    </span><span class="n">ggpairs</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/2f59020a2a81332b59d4998a9007d182b1151168d46c4cead6254983d20f47ed.png" src="../_images/2f59020a2a81332b59d4998a9007d182b1151168d46c4cead6254983d20f47ed.png" />
</div>
</div>
<p>Let us fit different combinations of covariates and inspect the models</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BMI</span> <span class="pre">+</span> <span class="pre">age</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># BMI + age covariates</span>

<span class="n">fit_BMI_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data_correlated</span><span class="p">)</span>

<span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">(</span><span class="n">fit_BMI_age</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 5</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th><th scope=col>std.error</th><th scope=col>statistic</th><th scope=col>p.value</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>51.5287670</td><td>2.57714073</td><td>19.99455</td><td> 2.335230e-84</td></tr>
	<tr><td>BMI        </td><td> 1.4990839</td><td>0.07894250</td><td>18.98957</td><td> 1.179596e-76</td></tr>
	<tr><td>age        </td><td> 0.8358078</td><td>0.03710561</td><td>22.52510</td><td>4.052878e-105</td></tr>
</tbody>
</table>
</div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BMI_related</span> <span class="pre">+</span> <span class="pre">age</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># BMI_related + age covariates</span>

<span class="n">fit_BMI_related_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI_related</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data_correlated</span><span class="p">)</span>

<span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">(</span><span class="n">fit_BMI_related_age</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 5</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th><th scope=col>std.error</th><th scope=col>statistic</th><th scope=col>p.value</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>57.8310999</td><td>2.51949328</td><td>22.95346</td><td>8.109952e-109</td></tr>
	<tr><td>BMI_related</td><td> 1.2131940</td><td>0.07367386</td><td>16.46709</td><td> 9.140178e-59</td></tr>
	<tr><td>age        </td><td> 0.8563963</td><td>0.03746843</td><td>22.85648</td><td>5.636234e-108</td></tr>
</tbody>
</table>
</div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BMI</span> <span class="pre">+</span> <span class="pre">BMI_related</span> <span class="pre">+</span> <span class="pre">age</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># BMI + BMI_related +age covariates</span>

<span class="n">fit_BMI_mixed_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">BMI_related</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data_correlated</span><span class="p">)</span>

<span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">(</span><span class="n">fit_BMI_mixed_age</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 4 × 5</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th><th scope=col>std.error</th><th scope=col>statistic</th><th scope=col>p.value</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>51.6445647</td><td>2.57712394</td><td>20.039612</td><td> 1.039234e-84</td></tr>
	<tr><td>BMI        </td><td> 1.8227156</td><td>0.19611117</td><td> 9.294298</td><td> 2.517797e-20</td></tr>
	<tr><td>BMI_related</td><td>-0.3261242</td><td>0.18091437</td><td>-1.802644</td><td> 7.152908e-02</td></tr>
	<tr><td>age        </td><td> 0.8349284</td><td>0.03709705</td><td>22.506600</td><td>5.864577e-105</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We notice something strange here. Although both BMI and BMI_related should be both significant in the model, only one of the covariates is significant</p>
<ul class="simple">
<li><p>Both BMI and BMI_related are highly correlated and this collinearity can affect the estimates of the linear model</p></li>
</ul>
<section id="using-a-variance-inflation-factor-vif-to-detect-collinearity">
<h3>Using a variance inflation factor (VIF) to detect collinearity<a class="headerlink" href="#using-a-variance-inflation-factor-vif-to-detect-collinearity" title="Permalink to this heading">#</a></h3>
<p>How can we detect collinearity for highly correlated covariates? We can check how much each covariate contributes to the increase in variance when the covariate is regressed to the other covariates</p>
<ul class="simple">
<li><p>We find <span class="math notranslate nohighlight">\(R^2\)</span> when covariate <span class="math notranslate nohighlight">\(j\)</span> is regressed to the other covariates: <code class="docutils literal notranslate"><span class="pre">lm(covariate_j</span> <span class="pre">~</span> <span class="pre">other</span> <span class="pre">covariate(s))</span></code></p></li>
<li><p>We calculate the VIF for covariate <span class="math notranslate nohighlight">\(j\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[\mathit{VIF}_{j}=\frac{1}{1-R_{j}^{2}}\]</div>
<p>VIF for <code class="docutils literal notranslate"><span class="pre">age</span></code></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># age regressed to other covariates</span>

<span class="n">r2_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="n">age</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">BMI_related</span><span class="p">,</span><span class="w"> </span><span class="n">data_correlated</span><span class="p">))</span><span class="o">$</span><span class="n">r.squared</span>

<span class="c1"># VIF age</span>

<span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">r2_age</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">1.01600290874057</div></div>
</div>
<p>VIF for <code class="docutils literal notranslate"><span class="pre">BMI</span></code></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># BMI regressed to other covariates</span>

<span class="n">r2_BMI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="n">BMI</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">BMI_related</span><span class="p">,</span><span class="w"> </span><span class="n">data_correlated</span><span class="p">))</span><span class="o">$</span><span class="n">r.squared</span>

<span class="c1"># VIF BMI</span>

<span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">r2_BMI</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">6.27304412112647</div></div>
</div>
<p>VIF for <code class="docutils literal notranslate"><span class="pre">BMI_related</span></code></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># BMI_related regressed to other covariates</span>

<span class="n">r2_BMI_related</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="n">BMI_related</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">BMI</span><span class="p">,</span><span class="w"> </span><span class="n">data_correlated</span><span class="p">))</span><span class="o">$</span><span class="n">r.squared</span>

<span class="c1"># VIF B</span>

<span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">r2_BMI_related</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">6.24980578978494</div></div>
</div>
<p>We see that when BMI or BMI_related are regressed to the remaining covariates, the VIF is high (&gt;5). This indicates that these covariates are likely to be correlated</p>
<p><strong>Using library functions</strong></p>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">vif</span></code> function from the <code class="docutils literal notranslate"><span class="pre">car</span></code> library to calculate the VIFs for covariates in a model</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">car</span><span class="o">::</span><span class="nf">vif</span><span class="p">(</span><span class="n">fit_BMI_mixed_age</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>BMI</dt><dd>6.27304412112646</dd><dt>BMI_related</dt><dd>6.24980578978493</dd><dt>age</dt><dd>1.01600290874057</dd></dl>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># adjust size of the image output</span>

<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">5</span><span class="p">)</span>

<span class="c1"># transform to table for plotting</span>

<span class="n">fit_vif</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">car</span><span class="o">::</span><span class="nf">vif</span><span class="p">(</span><span class="n">fit_BMI_mixed_age</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">           </span><span class="n">bind_rows</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">           </span><span class="nf">pivot_longer</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">everything</span><span class="p">(),</span><span class="w"> </span>
<span class="w">                        </span><span class="n">names_to</span><span class="o">=</span><span class="s">&quot;covariate&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                        </span><span class="n">values_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;VIF&quot;</span><span class="p">)</span>

<span class="c1"># plot VIF</span>

<span class="n">fit_vif</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">covariate</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">VIF</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">              </span><span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">              </span><span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">              </span><span class="nf">theme_grey</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
<span class=" -Color -Color-Cyan">ℹ</span> Please use `linewidth` instead.”
</pre></div>
</div>
<img alt="../_images/a62787fec014a204e06076adbf9ba6ea406ceabbac878351d518be08c0224b8b.png" src="../_images/a62787fec014a204e06076adbf9ba6ea406ceabbac878351d518be08c0224b8b.png" />
</div>
</div>
<p>So what can we do about it? When covariates are highly correlated, we can</p>
<ul class="simple">
<li><p>Omit one of the correlated covariates</p></li>
<li><p>Combine them into a single covariate (e.g. mean BP to combine systolic BP and diastolic BP)</p></li>
</ul>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="application-statistical-table-and-plotting">
<h1>Application: Statistical table and plotting<a class="headerlink" href="#application-statistical-table-and-plotting" title="Permalink to this heading">#</a></h1>
<p>We will be using these libraries for making statistical tables  and plots for the linear models</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stargazer</span></code>: statistical tables for models</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ggstatsplot</span></code>: plotting of the model coefficients</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ggfortify</span></code>: diagnostic plots for models</p></li>
</ul>
<p>To illustrate how we use them, we will build several models looking at the relationship between <code class="docutils literal notranslate"><span class="pre">sysBP</span></code> and <code class="docutils literal notranslate"><span class="pre">BMI</span></code> and<code class="docutils literal notranslate"><span class="pre">age</span></code> variables in the Framingham dataset</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>

<span class="c1"># load data</span>
<span class="n">data</span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;https://raw.githubusercontent.com/kennethban/dataset/main/framingham.csv&quot;</span><span class="p">)</span>

<span class="c1"># rename and change data types</span>
<span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">rename</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">male</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">education</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">education</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">currentSmoker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">currentSmoker</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">BPMeds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">BPMeds</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">prevalentStroke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">prevalentStroke</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">prevalentHyp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">prevalentHyp</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">diabetes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">diabetes</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">TenYearCHD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">TenYearCHD</span><span class="p">))</span>

<span class="c1"># filter out cases with BPMeds and drop missing values</span>
<span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">filter</span><span class="p">(</span><span class="n">BPMeds</span><span class="o">==</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="n">drop_na</span><span class="w">  </span>

<span class="nf">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Rows: </span><span class=" -Color -Color-Blue">4240</span> <span class=" -Color -Color-Bold">Columns: </span><span class=" -Color -Color-Blue">16</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Cyan">──</span> <span class=" -Color -Color-Bold">Column specification</span> <span class=" -Color -Color-Cyan">─────────────────────────────────────────────────────────────</span>
<span class=" -Color -Color-Bold">Delimiter:</span> &quot;,&quot;
<span class=" -Color -Color-Green">dbl</span> (16): male, age, education, currentSmoker, cigsPerDay, BPMeds, prevalent...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Cyan">ℹ</span> Use `spec()` to retrieve the full column specification for this data.
<span class=" -Color -Color-Cyan">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 16</caption>
<thead>
	<tr><th scope=col>sex</th><th scope=col>age</th><th scope=col>education</th><th scope=col>currentSmoker</th><th scope=col>cigsPerDay</th><th scope=col>BPMeds</th><th scope=col>prevalentStroke</th><th scope=col>prevalentHyp</th><th scope=col>diabetes</th><th scope=col>totChol</th><th scope=col>sysBP</th><th scope=col>diaBP</th><th scope=col>BMI</th><th scope=col>heartRate</th><th scope=col>glucose</th><th scope=col>TenYearCHD</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>39</td><td>4</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>195</td><td>106.0</td><td> 70</td><td>26.97</td><td>80</td><td> 77</td><td>0</td></tr>
	<tr><td>0</td><td>46</td><td>2</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>250</td><td>121.0</td><td> 81</td><td>28.73</td><td>95</td><td> 76</td><td>0</td></tr>
	<tr><td>1</td><td>48</td><td>1</td><td>1</td><td>20</td><td>0</td><td>0</td><td>0</td><td>0</td><td>245</td><td>127.5</td><td> 80</td><td>25.34</td><td>75</td><td> 70</td><td>0</td></tr>
	<tr><td>0</td><td>61</td><td>3</td><td>1</td><td>30</td><td>0</td><td>0</td><td>1</td><td>0</td><td>225</td><td>150.0</td><td> 95</td><td>28.58</td><td>65</td><td>103</td><td>1</td></tr>
	<tr><td>0</td><td>46</td><td>3</td><td>1</td><td>23</td><td>0</td><td>0</td><td>0</td><td>0</td><td>285</td><td>130.0</td><td> 84</td><td>23.10</td><td>85</td><td> 85</td><td>0</td></tr>
	<tr><td>0</td><td>43</td><td>2</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>228</td><td>180.0</td><td>110</td><td>30.30</td><td>77</td><td> 99</td><td>0</td></tr>
</tbody>
</table>
</div></div>
</div>
<section id="statistical-table">
<h2>1. Statistical table<a class="headerlink" href="#statistical-table" title="Permalink to this heading">#</a></h2>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">stargazer</span></code> function from the <code class="docutils literal notranslate"><span class="pre">stargazer</span></code> library to generate a statistical table from the model. The function can take one or more models as its input and we can specify the following options</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ci</span></code>: set to TRUE to print the confidence intervals</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: set to HTML to print the table in the notebook</p></li>
</ul>
<p>We will define a local function <code class="docutils literal notranslate"><span class="pre">print_html</span></code> to print the HTML output from <code class="docutils literal notranslate"><span class="pre">stargazer</span></code> in the notebook</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># print table convenience function</span>

<span class="n">print_html</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>
<span class="w">    </span><span class="nf">capture.output</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">paste</span><span class="p">(</span><span class="n">collapse</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="n">IRdisplay</span><span class="o">::</span><span class="nf">display_html</span><span class="p">()</span>
<span class="w">    </span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>We will fit several models and print them in a table</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fit_BMI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="n">fit_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="n">fit_BMI_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">sysBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>

<span class="c1"># print stargazer table and compare all 3 models</span>

<span class="nf">library</span><span class="p">(</span><span class="n">stargazer</span><span class="p">)</span>

<span class="nf">stargazer</span><span class="p">(</span><span class="n">fit_BMI</span><span class="p">,</span><span class="w"> </span><span class="n">fit_age</span><span class="p">,</span><span class="w"> </span><span class="n">fit_BMI_age</span><span class="p">,</span><span class="w"> </span><span class="n">ci</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;html&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">print_html</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Please cite as: 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Hlavac, Marek (2022). stargazer: Well-Formatted Regression and Summary Statistics Tables.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> R package version 5.2.3. https://CRAN.R-project.org/package=stargazer 
</pre></div>
</div>
<div class="output text_html"><table style="text-align:center"><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td colspan="3"><em>Dependent variable:</em></td></tr><tr><td></td><td colspan="3" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td colspan="3">sysBP</td></tr><tr><td style="text-align:left"></td><td>(1)</td><td>(2)</td><td>(3)</td></tr><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">BMI</td><td>1.721<sup>***</sup></td><td></td><td>1.499<sup>***</sup></td></tr><tr><td style="text-align:left"></td><td>(1.557, 1.885)</td><td></td><td>(1.344, 1.654)</td></tr><tr><td style="text-align:left"></td><td></td><td></td><td></td></tr><tr><td style="text-align:left">age</td><td></td><td>0.924<sup>***</sup></td><td>0.836<sup>***</sup></td></tr><tr><td style="text-align:left"></td><td></td><td>(0.848, 0.999)</td><td>(0.763, 0.909)</td></tr><tr><td style="text-align:left"></td><td></td><td></td><td></td></tr><tr><td style="text-align:left">Constant</td><td>87.068<sup>***</sup></td><td>85.725<sup>***</sup></td><td>51.529<sup>***</sup></td></tr><tr><td style="text-align:left"></td><td>(82.799, 91.338)</td><td>(81.933, 89.517)</td><td>(46.478, 56.580)</td></tr><tr><td style="text-align:left"></td><td></td><td></td><td></td></tr><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Observations</td><td>3,547</td><td>3,547</td><td>3,547</td></tr><tr><td style="text-align:left">R<sup>2</sup></td><td>0.106</td><td>0.139</td><td>0.218</td></tr><tr><td style="text-align:left">Adjusted R<sup>2</sup></td><td>0.106</td><td>0.139</td><td>0.218</td></tr><tr><td style="text-align:left">Residual Std. Error</td><td>19.946 (df = 3545)</td><td>19.581 (df = 3545)</td><td>18.657 (df = 3544)</td></tr><tr><td style="text-align:left">F Statistic</td><td>422.468<sup>***</sup> (df = 1; 3545)</td><td>571.608<sup>***</sup> (df = 1; 3545)</td><td>495.098<sup>***</sup> (df = 2; 3544)</td></tr><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"><em>Note:</em></td><td colspan="3" style="text-align:right"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr></table></div></div>
</div>
</section>
<section id="statistical-plot">
<h2>2. Statistical plot<a class="headerlink" href="#statistical-plot" title="Permalink to this heading">#</a></h2>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">ggcoefstats</span></code> function from <code class="docutils literal notranslate"><span class="pre">ggstatsplot</span></code> to generate a plot of the coefficients with the confidence intervals and the associate p-values. We can specify the following options</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">exclude.intercept</span></code>: set to TRUE to omit the intercept</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats.label.args</span></code>: provide a list of options for the labels if desired</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggstatsplot</span><span class="p">)</span>

<span class="c1"># adjust size of the image output</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">8</span><span class="p">)</span>

<span class="n">fit_BMI_age</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">ggcoefstats</span><span class="p">(</span><span class="n">exclude.intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">T</span><span class="p">,</span>
<span class="w">                            </span><span class="n">stats.label.args</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">nudge_y</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                                  </span><span class="n">size</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                                  </span><span class="n">label.size</span><span class="o">=</span><span class="kc">NA</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">                </span><span class="nf">theme_grey</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You can cite this package as:
     Patil, I. (2021). Visualizations with statistical details: The &#39;ggstatsplot&#39; approach.
     Journal of Open Source Software, 6(61), 3167, doi:10.21105/joss.03167
</pre></div>
</div>
<img alt="../_images/5ab0ec8fda21be0a26623300f725ce29f5dfde9c79bd6c4628b8126ff1e3bb53.png" src="../_images/5ab0ec8fda21be0a26623300f725ce29f5dfde9c79bd6c4628b8126ff1e3bb53.png" />
</div>
</div>
</section>
<section id="diagnostic-plot">
<h2>3. Diagnostic plot<a class="headerlink" href="#diagnostic-plot" title="Permalink to this heading">#</a></h2>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">autoplot</span></code> function from the <code class="docutils literal notranslate"><span class="pre">ggfortify</span></code> library to generate basic diagnostic plots of the residuals. For simplicity, we specify the option <code class="docutils literal notranslate"><span class="pre">which</span> <span class="pre">=</span> <span class="pre">1:2</span></code> to limit the plots to</p>
<ul class="simple">
<li><p>Residuals vs Fitted</p></li>
<li><p>Normal Q-Q</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggfortify</span><span class="p">)</span>

<span class="c1"># adjust size of the image output</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">5</span><span class="p">)</span>

<span class="nf">autoplot</span><span class="p">(</span><span class="n">fit_BMI_age</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/79cb4cf244555b3722000b22d3dfa4fa454140641b4e48821f421fd6fe0df0bf.png" src="../_images/79cb4cf244555b3722000b22d3dfa4fa454140641b4e48821f421fd6fe0df0bf.png" />
</div>
</div>
</section>
<hr class="docutils" />
<section id="exercise-modeling-multiple-covariates">
<h2>Exercise - Modeling (Multiple covariates)<a class="headerlink" href="#exercise-modeling-multiple-covariates" title="Permalink to this heading">#</a></h2>
<p>For this exercise, we will use the Framingham dataset and model the relationship between <code class="docutils literal notranslate"><span class="pre">totChol</span></code> and 2 covariates <code class="docutils literal notranslate"><span class="pre">BMI</span></code> and <code class="docutils literal notranslate"><span class="pre">age</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>

<span class="c1"># load data</span>
<span class="n">data</span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;https://raw.githubusercontent.com/kennethban/dataset/main/framingham.csv&quot;</span><span class="p">)</span>

<span class="c1"># rename and change data types</span>
<span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">rename</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">male</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">education</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">education</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">currentSmoker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">currentSmoker</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">BPMeds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">BPMeds</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">prevalentStroke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">prevalentStroke</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">prevalentHyp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">prevalentHyp</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">diabetes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">diabetes</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">mutate</span><span class="p">(</span><span class="n">TenYearCHD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">TenYearCHD</span><span class="p">))</span>

<span class="c1"># filter out cases with BPMeds and drop missing values</span>
<span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">filter</span><span class="p">(</span><span class="n">BPMeds</span><span class="o">==</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="n">drop_na</span><span class="w">  </span>

<span class="nf">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Rows: </span><span class=" -Color -Color-Blue">4240</span> <span class=" -Color -Color-Bold">Columns: </span><span class=" -Color -Color-Blue">16</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Cyan">──</span> <span class=" -Color -Color-Bold">Column specification</span> <span class=" -Color -Color-Cyan">─────────────────────────────────────────────────────────────</span>
<span class=" -Color -Color-Bold">Delimiter:</span> &quot;,&quot;
<span class=" -Color -Color-Green">dbl</span> (16): male, age, education, currentSmoker, cigsPerDay, BPMeds, prevalent...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Cyan">ℹ</span> Use `spec()` to retrieve the full column specification for this data.
<span class=" -Color -Color-Cyan">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 16</caption>
<thead>
	<tr><th scope=col>sex</th><th scope=col>age</th><th scope=col>education</th><th scope=col>currentSmoker</th><th scope=col>cigsPerDay</th><th scope=col>BPMeds</th><th scope=col>prevalentStroke</th><th scope=col>prevalentHyp</th><th scope=col>diabetes</th><th scope=col>totChol</th><th scope=col>sysBP</th><th scope=col>diaBP</th><th scope=col>BMI</th><th scope=col>heartRate</th><th scope=col>glucose</th><th scope=col>TenYearCHD</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>39</td><td>4</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>195</td><td>106.0</td><td> 70</td><td>26.97</td><td>80</td><td> 77</td><td>0</td></tr>
	<tr><td>0</td><td>46</td><td>2</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>250</td><td>121.0</td><td> 81</td><td>28.73</td><td>95</td><td> 76</td><td>0</td></tr>
	<tr><td>1</td><td>48</td><td>1</td><td>1</td><td>20</td><td>0</td><td>0</td><td>0</td><td>0</td><td>245</td><td>127.5</td><td> 80</td><td>25.34</td><td>75</td><td> 70</td><td>0</td></tr>
	<tr><td>0</td><td>61</td><td>3</td><td>1</td><td>30</td><td>0</td><td>0</td><td>1</td><td>0</td><td>225</td><td>150.0</td><td> 95</td><td>28.58</td><td>65</td><td>103</td><td>1</td></tr>
	<tr><td>0</td><td>46</td><td>3</td><td>1</td><td>23</td><td>0</td><td>0</td><td>0</td><td>0</td><td>285</td><td>130.0</td><td> 84</td><td>23.10</td><td>85</td><td> 85</td><td>0</td></tr>
	<tr><td>0</td><td>43</td><td>2</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>228</td><td>180.0</td><td>110</td><td>30.30</td><td>77</td><td> 99</td><td>0</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We will define a local function <code class="docutils literal notranslate"><span class="pre">print_html</span></code> to print the HTML output from <code class="docutils literal notranslate"><span class="pre">stargazer</span></code> in the notebook</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># print html convenience function</span>

<span class="n">print_html</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>
<span class="w">    </span><span class="nf">capture.output</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">paste</span><span class="p">(</span><span class="n">collapse</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="n">IRdisplay</span><span class="o">::</span><span class="nf">display_html</span><span class="p">()</span>
<span class="w">    </span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<section id="part-1">
<h3>Part 1<a class="headerlink" href="#part-1" title="Permalink to this heading">#</a></h3>
<p>Build a linear model using the <code class="docutils literal notranslate"><span class="pre">lm</span></code> function and store it as <code class="docutils literal notranslate"><span class="pre">myfit_BMI</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">totChol</span></code>: dependent/response variable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BMI</span></code>: independent/explanatory variable</p></li>
</ul>
<p>Build a linear model using the <code class="docutils literal notranslate"><span class="pre">lm</span></code> function and store it as <code class="docutils literal notranslate"><span class="pre">myfit_age</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">totChol</span></code>: dependent/response variable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">age</span></code>: independent/explanatory variable</p></li>
</ul>
<p>Build a linear model using the <code class="docutils literal notranslate"><span class="pre">lm</span></code> function and store it as <code class="docutils literal notranslate"><span class="pre">myfit_BMI_age</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">totChol</span></code>: dependent/response variable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BMI</span></code>: independent/explanatory variable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">age</span></code>: independent/explanatory variable</p></li>
</ul>
<p>Create a <code class="docutils literal notranslate"><span class="pre">stargazer</span></code> table that shows 3 models side-by-side</p>
<ul class="simple">
<li><p>Explain the coefficients</p></li>
<li><p>Explain which model may be a better fit to the data</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">stargazer</span><span class="p">)</span>

<span class="c1"># start here</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># solution</span>

<span class="nf">library</span><span class="p">(</span><span class="n">stargazer</span><span class="p">)</span>

<span class="n">myfit_BMI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">totChol</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="n">myfit_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">totChol</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="n">myfit_BMI_age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">totChol</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">BMI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>

<span class="nf">stargazer</span><span class="p">(</span><span class="n">myfit_BMI</span><span class="p">,</span><span class="w"> </span><span class="n">myfit_age</span><span class="p">,</span><span class="w"> </span><span class="n">myfit_BMI_age</span><span class="p">,</span><span class="w"> </span><span class="n">ci</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">T</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;html&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">print_html</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table style="text-align:center"><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td colspan="3"><em>Dependent variable:</em></td></tr><tr><td></td><td colspan="3" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td colspan="3">totChol</td></tr><tr><td style="text-align:left"></td><td>(1)</td><td>(2)</td><td>(3)</td></tr><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">BMI</td><td>1.219<sup>***</sup></td><td></td><td>0.868<sup>***</sup></td></tr><tr><td style="text-align:left"></td><td>(0.861, 1.577)</td><td></td><td>(0.519, 1.217)</td></tr><tr><td style="text-align:left"></td><td></td><td></td><td></td></tr><tr><td style="text-align:left">age</td><td></td><td>1.372<sup>***</sup></td><td>1.321<sup>***</sup></td></tr><tr><td style="text-align:left"></td><td></td><td>(1.209, 1.536)</td><td>(1.157, 1.485)</td></tr><tr><td style="text-align:left"></td><td></td><td></td><td></td></tr><tr><td style="text-align:left">Constant</td><td>204.776<sup>***</sup></td><td>168.391<sup>***</sup></td><td>148.588<sup>***</sup></td></tr><tr><td style="text-align:left"></td><td>(195.458, 214.093)</td><td>(160.216, 176.567)</td><td>(137.196, 159.979)</td></tr><tr><td style="text-align:left"></td><td></td><td></td><td></td></tr><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Observations</td><td>3,547</td><td>3,547</td><td>3,547</td></tr><tr><td style="text-align:left">R<sup>2</sup></td><td>0.012</td><td>0.071</td><td>0.077</td></tr><tr><td style="text-align:left">Adjusted R<sup>2</sup></td><td>0.012</td><td>0.071</td><td>0.077</td></tr><tr><td style="text-align:left">Residual Std. Error</td><td>43.528 (df = 3545)</td><td>42.214 (df = 3545)</td><td>42.079 (df = 3544)</td></tr><tr><td style="text-align:left">F Statistic</td><td>44.506<sup>***</sup> (df = 1; 3545)</td><td>271.435<sup>***</sup> (df = 1; 3545)</td><td>148.477<sup>***</sup> (df = 2; 3544)</td></tr><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"><em>Note:</em></td><td colspan="3" style="text-align:right"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr></table></div></div>
</details>
</div>
</section>
<section id="part-2">
<h3>Part 2<a class="headerlink" href="#part-2" title="Permalink to this heading">#</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">ggcoefstats</span></code> to plot the coefficient(s) in the <code class="docutils literal notranslate"><span class="pre">myfit_BMI_age</span></code> model. You may exclude the intercept from the plot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggstatsplot</span><span class="p">)</span>

<span class="c1"># start here</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># solution</span>

<span class="nf">library</span><span class="p">(</span><span class="n">ggstatsplot</span><span class="p">)</span>

<span class="c1"># set plot dimensions</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">8</span><span class="p">)</span>

<span class="n">myfit_BMI_age</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">ggcoefstats</span><span class="p">(</span><span class="n">exclude.intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/45e3972303b8e44faf5f5386947c7241207f15d99bb8216fb2646c9fed85b543.png" src="../_images/45e3972303b8e44faf5f5386947c7241207f15d99bb8216fb2646c9fed85b543.png" />
</div>
</details>
</div>
</section>
<section id="part-3">
<h3>Part 3<a class="headerlink" href="#part-3" title="Permalink to this heading">#</a></h3>
<p>Create a diagnostic plot for the <code class="docutils literal notranslate"><span class="pre">myfit_bmi_age</span></code> model using <code class="docutils literal notranslate"><span class="pre">autoplot</span></code> from <code class="docutils literal notranslate"><span class="pre">ggfortify</span></code></p>
<ul class="simple">
<li><p>Interpret the plot</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggfortify</span><span class="p">)</span>

<span class="c1"># start here</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># solution</span>

<span class="nf">library</span><span class="p">(</span><span class="n">ggfortify</span><span class="p">)</span>

<span class="c1"># set plot dimensions</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>

<span class="n">myfit_BMI_age</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/989a837857580f391b8f2cd03805713c83b9fe23b9098a975619c9fc1f1d8f2d.png" src="../_images/989a837857580f391b8f2cd03805713c83b9fe23b9098a975619c9fc1f1d8f2d.png" />
</div>
</details>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./03-intro-to-stats"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="07-modeling.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Linear Modeling - Simple</p>
      </div>
    </a>
    <a class="right-next"
       href="07-2-modeling.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Linear Modeling - Categorical</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Linear Modeling - Multiple</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-the-linear-model-using-matrices">Solving the linear model using matrices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analytical-approach">Analytical approach</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#significance-testing-of-coefficients">Significance testing of coefficients</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-test-statistic">1. Calculate the test statistic</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#use-the-theoretical-null-distribution-to-calculate-the-p-value">2. Use the theoretical null distribution to calculate the p-value</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-interval-of-coefficients">Confidence interval of coefficients</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-library-functions">Using library functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-well-does-the-model-fit-the-data">How well does the model fit the data?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#r-2-and-adjusted-r-2">1. <span class="math notranslate nohighlight">\(R^2\)</span> and adjusted <span class="math notranslate nohighlight">\(R^2\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostic-plot-of-residuals">2. Diagnostic plot of residuals</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem-of-highly-correlated-variables">The problem of highly correlated variables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-variance-inflation-factor-vif-to-detect-collinearity">Using a variance inflation factor (VIF) to detect collinearity</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-statistical-table-and-plotting">Application: Statistical table and plotting</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-table">1. Statistical table</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-plot">2. Statistical plot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostic-plot">3. Diagnostic plot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-modeling-multiple-covariates">Exercise - Modeling (Multiple covariates)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1">Part 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2">Part 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3">Part 3</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kenneth Ban, NUS Medicine
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022-23.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>